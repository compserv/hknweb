{% extends "base.html" %}
{% load static %}

{% block header %}
<link rel="stylesheet" href="{% static "candidate/style.css" %}">
<style>
    .conf-events a {
        text-decoration: none;
        color: #535353;
    }
    .conf-events a:hover {
        text-decoration: underline;
    }
    .unconf-events a {
        text-decoration: none;
        color: #535353;
    }
    .unconf-events a:hover {
        text-decoration: underline;
    }
</style>
{% endblock %}


{% block title %}
    {% if not user_self %}{{ username }}'s{% endif %}
    Candidate portal
{% endblock %}

{% block heading %}
    {% if not user_self %}{{ username }}'s{% endif %}
    Candidate Portal
{% endblock %}

{% block content %}
<div class="parent centered">
    {% if messages %}
        {% for message in messages %}
            <h3  {% if messages.tags %} class="{{ message.tags }}" {% endif %} class="blue">{{ message }}</h3>
        {% endfor %}
    {% endif %}
    {% if user_self %}
    <section>
        <h2>Announcements</h2>

        {% if not announcements %}
            No announcements at this time.
        {% endif %}

        {% for announcement in announcements %}
            <p>
            <strong>{{ announcement.title }}</strong> [{{ announcement.release_date|date:"m/d/Y" }}]<br>
            {{ announcement.text }}
            </p>
        {% endfor %}
    </section>
    <br>
    <section>
        <h2>Upcoming Events</h2>
        {% if upcoming_events %}
        <table class="full-table">
            <thead>
                <th align="left">Event</th>
                <th align="left">Event type</th>
                <th align="left">Time</th>
                <th align="left">Location</th>
            </thead>

            <tbody>
            {% for event in upcoming_events %}
                <tr>
                    <td><a href="{% url 'events:detail' event.id %}"> {{ event.name }} </a></td>
                    <td>{{ event.event_type }}</td>
                    <td>{{event.start_time|date:"D m/d h:i A"}} - {{ event.end_time|date:"h:i A"}}</td>
                    <td>{{ event.location }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </section>
    <br>
    {% endif %}
    <section id="candidate-checklist">
        <h2 class="events-list">
            {% if not user_self %}
                {{ username }}'s
            {% endif %}
            Candidate Checklist - {{ logistics.semester }}
        </h2>

        <div class="checklist-left-col">
            <h4>
                {% if logistics.event_reqs_finished %}
                    <span class="req done"></span>
                {% else %}
                    <span class="req not-done"></span>
                {% endif %}
                Events
            </h4>
            <ul class="checkboxes events-list">
                {% for event_req in logistics.event_req_objs %}
                    <li>
                        {% if event_req.n_finished >= event_req.n %}
                            <span class="req done"></span>
                        {% else %}
                            <span class="req not-done"></span>
                        {% endif %}
                        <span style="background:{{ event_req.event_types.first.color }}" class="req-title">
                            {{ event_req.title }} ({{ event_req.n }} required, {{ event_req.n_finished }} finished)
                        </span>
                    </li>
                    <ul class="conf-events">
                        {% for e in event_req.confirmed %}
                            <li>
                                <a href="{% url 'events:detail' e.id %}">{{ e.name }}</a>
                                <br/>
                            </li>
                        {% endfor %}
                    </ul>
                    <ul class="unconf-events">
                        {% for e in event_req.unconfirmed %}
                            <li>
                                <a href="{% url 'events:detail' e.id %}">{{ e.name }}</a>
                                <br/>
                            </li>
                        {% endfor %}
                    </ul>
                    <br/>
                {% endfor %}
            </ul>
        </div>
        <div class="checklist-right-col">
            <h4>
                {% if logistics.n_interactivities >= logistics.num_interactivities %}
                    <span class="req done"></span>
                {% else %}
                    <span class="req not-done"></span>
                {% endif %}
                Interactivities ({{ logistics.num_interactivities }} required, {{ logistics.n_interactivities }} finished)
            </h4>
            <ul class="checkboxes">
                <li>
                    {% if logistics.n_challenges_confirmed >= logistics.min_challenges %}
                        <span class="req done"></span>
                    {% else %}
                        <span class="req not-done"></span>
                    {% endif %}
                    Officer Challenges ({{ logistics.min_challenges }} required, {{ logistics.n_challenges_confirmed }} finished)
                </li>
                <a href="{% url 'candidate:candrequests' %}">
                    (View/Request Officer Challenge Confirmations)</a>
                <ul>
                    <li>{{ logistics.n_challenges_pending }} pending</li>
                    <li>{{ logistics.n_challenges_rejected }} rejected</li>
                    <li>{{ logistics.n_challenges_confirmed }} confirmed</li>
                </ul>
                <li>
                    {% if logistics.hangouts_confirmed|length >= logistics.min_hangouts %}
                        <span class="req done"></span>
                    {% else %}
                        <span class="req not-done"></span>
                    {% endif %}
                    Officer Hangouts ({{ logistics.min_hangouts }} required, {{ logistics.hangouts_confirmed|length }} finished)
                </li>
                <ul class="conf-events">
                    {% for e in logistics.hangouts_confirmed %}
                        <li><a href="{% url 'events:detail' e.id %}">{{ e.name }}</a><br/></li>
                    {% endfor %}
                </ul>
                <ul class="unconf-events">
                    {% for e in logistics.hangouts_unconfirmed %}
                        <li><a href="{% url 'events:detail' e.id %}">{{ e.name }}</a><br/></li>
                    {% endfor %}
                </ul>
            </ul>

            <h4>
                {% if logistics.forms_unconfirmed|length == 0 %}
                    <span class="req done"></span>
                {% else %}
                    <span class="req not-done"></span>
                {% endif %}
                Forms
            </h4>
            <ul class="events-list conf-events">
                {% for f in logistics.forms_confirmed %}
                    <li>
                        <a href="{{ f.link }}">{{ f.title }}</a>
                    </li>
                {% endfor %}
            </ul>
            <ul class="events-list unconf-events">
                {% for f in logistics.forms_unconfirmed %}
                    <li>
                        <a href="{{ f.link }}">{{ f.title }}</a>
                    </li>
                {% endfor %}
            </ul>

            <ul class="events-list">
                {% for m in misc_reqs %}
                    <li>
                        {% if request.user in m.completed %}
                            <span class="req done"></span>
                        {% else %}
                            <span class="req not-done"></span>
                        {% endif %}
                        {{ m.title }} - {{ m.description }}
                    </li>
                {% endfor %}
            </ul>
            <h4>
                {% if logistics.misc_unconfirmed|length == 0 %}
                    <span class="req done"></span>
                {% else %}
                    <span class="req not-done"></span>
                {% endif %}
                Miscellaneous Requirements
            </h4>
            <ul class="events-list conf-events">
                {% for m in logistics.misc_confirmed %}
                    <li>
                        {{ m.title }} - {{ m.description }}
                    </li>
                {% endfor %}
            </ul>
            <ul class="events-list unconf-events">
                {% for m in logistics.misc_unconfirmed %}
                    <li>
                        {{ m.title }} - {{ m.description }}
                    </li>
                {% endfor %}
            </ul>
        </div>

        <h4>
            {% if logistics.n_bitbyte >= logistics.num_bitbyte %}
                <span class="req done"></span>
            {% else %}
                <span class="req not-done"></span>
            {% endif %}
            Bit-Byte ({{ logistics.num_bitbyte }} required, {{ logistics.n_bitbyte }} finished)
        </h4>
        <div class="checklist-left-col" style="width: 25%;">
            <h4 style="text-align: center; margin-bottom: 0;">Submit Bit-Byte Activity</h4>

            <form method="POST" action="{% url 'candidate:bitbyte' %}" onsubmit="submit_button.disabled = true; return true;">
                {% csrf_token %}
                {% for field in form %}
                    <br>
                    <span class="left">{{ field.label }}
                        {% if field.field.required %}<span class="red">* </span>{% endif %}
                    </span>&nbsp
                    {% if field.label == 'Proof' %}
                        <span class="tooltip">
                            <img src="{% static 'candidate/more_info.png' %}" alt="more info" class="inline-icon">
                            <span class="tooltiptext">
                                Please send a photo to #bitbyte on Slack and paste the link here, along
                                with any comments. You can obtain the link by clicking "More actions->Copy link"
                                on Slack. The link should start with "https://hkn.slack.com/archives/"
                            </span>
                        </span>
                    {% endif %}
                    {{ field }}
                {% endfor %}
                <input type="submit" name="submit_button" value="Submit" />
            </form>
        </div>
        <div class="checklist-right-col" style="width: 70%;">
            <h4 style="text-align: center;">Past bitbyte activities</h4>
            <ul class="checkboxes">
                {% if logistics.bitbytes %}
                    <table class="full-table">
                        <thead>
                            <th>Participants</th>
                            <th>Confirmed</th>
                            <th>Request Date</th>
                            <th>Proof</th>
                            <th>Notes</th>
                        </thead>

                        <tbody>
                        {% for bitbyte in logistics.bitbytes %}
                            <tr>
                                <td align="center">{% for participant in bitbyte.participants.all %}
                                    {{ participant.first_name }} {{ participant.last_name }} ({{ participant.username }}) <br>
                                {% endfor %}</td>
                                <td align="center">
                                    {% if bitbyte.is_confirmed %}
                                        <img src="{% static 'candidate/yes.png'%}" alt="confirmed" class="table-icon">
                                    {% elif bitbyte.is_rejected %}
                                        <img src="{% static 'candidate/no.png'%}" alt="rejected" class="table-icon">
                                    {% else %}
                                        <img src="{% static 'candidate/maybe.png'%}" alt="in progress" class="table-icon">
                                    {% endif %}
                                </td>
                                <td align="center">{{ bitbyte.request_date|date }}</td>
                                <td class="table-column-max" align="center">{{ bitbyte.proof }}</td>
                                <td class="table-column-max" align="center">{{ bitbyte.notes }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p>No activities to show.</p>
                {% endif %}
            </ul>
        </div>
    </section>
</div>
{% endblock %}
