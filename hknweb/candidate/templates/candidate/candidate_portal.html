{% extends "base.html" %}
{% load static %}

{% block header %}
<link rel="stylesheet" href="{% static "candidate/style.css" %}">
<style>
    .conf-events a {
        text-decoration: none;
        color: #535353;
    }

    .conf-events a:hover {
        text-decoration: underline;
    }

    .unconf-events a {
        text-decoration: none;
        color: #535353;
    }

    .unconf-events a:hover {
        text-decoration: underline;
    }

    h3, h4 {
        margin-top: 0;
    }

    h4 {
        margin-bottom: 0;
    }

    .select2-container--default .select2-selection--single {
        border: none;
    }

    .select2-container--default .select2-selection--multiple {
        border: none;
    }
</style>
{% endblock %}


{% block title %}
    {% if not user_self %}{{ username }}'s{% endif %}
    Candidate portal
{% endblock %}

{% block heading %}
    {% if not user_self %}{{ username }}'s{% endif %}
    Candidate Portal - {{ logistics.semester }}
{% endblock %}

{% block content %}
<div class="parent centered">
    {% if messages %}
        {% for message in messages %}
            <h3 style="text-align: center;" {% if messages.tags %} class="{{ message.tags }}" {% endif %} class="blue">{{ message }}</h3>
        {% endfor %}
    {% endif %}

    {% if user_self %}
        <section>
            <div class="checklist-left-col">
                <h2>Announcements</h2>
                {% if not announcements %}
                    No announcements at this time.
                {% endif %}

                {% for announcement in announcements %}
                    <p>
                    <strong>{{ announcement.title }}</strong> [{{ announcement.release_date|date:"m/d/Y" }}]<br>
                    {{ announcement.text }}
                    </p>
                {% endfor %}
            </div>
            <div class="checklist-right-col">
                <h2>Upcoming Events</h2>
                {% if upcoming_events %}
                    <table class="full-table">
                        <thead>
                            <th align="left">Event</th>
                            <th align="left">Event type</th>
                            <th align="left">Time</th>
                            <th align="left">Location</th>
                        </thead>

                        <tbody>
                            {% for event in upcoming_events %}
                                <tr>
                                    <td><a href="{% url 'events:detail' event.id %}"> {{ event.name }} </a></td>
                                    <td>{{ event.event_type }}</td>
                                    <td>{{event.start_time|date:"D m/d h:i A"}} - {{ event.end_time|date:"h:i A"}}</td>
                                    <td>{{ event.location }}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% endif %}
            </div>
        </section>
    {% endif %}

    <section>
        <div class="checklist-left-col">
            <h3>
                {% if logistics.event_reqs_finished %}
                    <span class="req done"></span>
                {% else %}
                    <span class="req not-done"></span>
                {% endif %}
                Events
            </h3>
            <ul class="checkboxes events-list">
                {% for event_req in logistics.event_req_objs %}
                    <li>
                        {% if event_req.n_finished >= event_req.n %}
                            <span class="req done"></span>
                        {% else %}
                            <span class="req not-done"></span>
                        {% endif %}
                        <span style="background:{{ event_req.event_types.first.color }}" class="req-title">
                            {{ event_req.title }} ({{ event_req.n }} required, {{ event_req.n_finished }} finished)
                        </span>
                    </li>
                    <ul class="conf-events">
                        {% for e in event_req.confirmed %}
                            <li>
                                <a href="{% url 'events:detail' e.id %}">{{ e.name }}</a>
                                <br/>
                            </li>
                        {% endfor %}
                    </ul>
                    <ul class="unconf-events">
                        {% for e in event_req.unconfirmed %}
                            <li>
                                <a href="{% url 'events:detail' e.id %}">{{ e.name }}</a>
                                <br/>
                            </li>
                        {% endfor %}
                    </ul>
                    <br/>
                {% endfor %}
            </ul>
        </div>
        <div class="checklist-right-col">
            <h3>
                {% if logistics.forms_unconfirmed|length == 0 %}
                    <span class="req done"></span>
                {% else %}
                    <span class="req not-done"></span>
                {% endif %}
                Forms
            </h3>
            <ul class="events-list conf-events">
                {% for f in logistics.forms_confirmed %}
                    <li>
                        <a href="{{ f.link }}">{{ f.title }}</a>
                    </li>
                {% endfor %}
            </ul>
            <ul class="events-list unconf-events">
                {% for f in logistics.forms_unconfirmed %}
                    <li>
                        <a href="{{ f.link }}">{{ f.title }}</a>
                    </li>
                {% endfor %}
            </ul>

            <ul class="events-list">
                {% for m in misc_reqs %}
                    <li>
                        {% if request.user in m.completed %}
                            <span class="req done"></span>
                        {% else %}
                            <span class="req not-done"></span>
                        {% endif %}
                        {{ m.title }} - {{ m.description }}
                    </li>
                {% endfor %}
            </ul>
            <h3>
                {% if logistics.misc_unconfirmed|length == 0 %}
                    <span class="req done"></span>
                {% else %}
                    <span class="req not-done"></span>
                {% endif %}
                Miscellaneous Requirements
            </h3>
            <ul class="events-list conf-events">
                {% for m in logistics.misc_confirmed %}
                    <li>
                        {{ m.title }} - {{ m.description }}
                    </li>
                {% endfor %}
            </ul>
            <ul class="events-list unconf-events">
                {% for m in logistics.misc_unconfirmed %}
                    <li>
                        {{ m.title }} - {{ m.description }}
                    </li>
                {% endfor %}
            </ul>
        </div>
    </section>

    <section>
        <h3 style="margin-bottom: 0;">
            {% if logistics.n_bitbyte >= logistics.num_bitbyte %}
                <span class="req done"></span>
            {% else %}
                <span class="req not-done"></span>
            {% endif %}
            Bit-Byte ({{ logistics.num_bitbyte }} required, {{ logistics.n_bitbyte }} finished)
        </h3>
        {% if user_self %}
            <div class="checklist-left-col" style="width: 25%; margin-left: 0.5em;">
                <form method="POST" action="{% url 'candidate:request_bitbyte' %}" onsubmit="submit_button.disabled = true; return true;">
                    {% csrf_token %}
                    <br>
                    {% for field in bitbyte_form %}
                        <span class="left">{{ field.label }}
                            {% if field.field.required %}<span class="red">* </span>{% endif %}
                        </span>&nbsp
                        {% if field.label == 'Proof' %}
                            <span class="tooltip">
                                <img src="{% static 'candidate/more_info.png' %}" alt="more info" class="inline-icon">
                                <span class="tooltiptext">
                                    Please send a photo to #bitbyte on Slack and paste the link here, along
                                    with any comments. You can obtain the link by clicking "More actions->Copy link"
                                    on Slack. The link should start with "https://hkn.slack.com/archives/"
                                </span>
                            </span>
                        {% endif %}
                        {{ field }}
                        <br>
                    {% endfor %}
                    <div style="text-align: center;">
                        <input type="submit" name="submit_button" value="Submit" />
                    </div>
                </form>
            </div>
        {% endif %}
        <div class="checklist-right-col" style="width: 70%;">
            <ul class="checkboxes">
                {% include 'candidate/bitbytes_table.html' %}
            </ul>
        </div>
    </section>

    <section>
        <h3>
            {% if logistics.n_interactivities >= logistics.num_interactivities %}
                <span class="req done"></span>
            {% else %}
                <span class="req not-done"></span>
            {% endif %}
            Interactivities ({{ logistics.num_interactivities }} required, {{ logistics.n_interactivities }} finished)
        </h3>
        {% if user_self %}
            <div class="checklist-left-col" style="width: 25%; margin-left: 0.5em;">
                <h4 style="text-align: center; margin-bottom: 0;">Submit officer challenge</h4>

                <form method="POST" action="{% url 'candidate:request_challenge' %}" onsubmit="submit_button.disabled = true; return true;">
                    {% csrf_token %}
                    {% for field in challenge_form %}
                        <br>
                        <span class="left">{{ field.label }}
                            {% if field.field.required %}<span class="red">* </span>{% endif %}
                        </span>
                        {% if field.label == 'Proof' %}
                            <span class="tooltip" style="bottom: 0.1em; left: 0.1em;">
                                <img src="{% static 'candidate/more_info.png' %}" alt="more info" class="inline-icon">
                                <span class="tooltiptext">
                                    You can include some proof that you've completed the challenge.
                                    If applicable, send it to #challenges on Slack and paste a link here.
                                    You can obtain the link by clicking "More actions->Copy link"
                                    on Slack. The link should start with "https://hkn.slack.com/archives/"
                                </span>
                            </span>
                        {% endif %}
                        <br>
                        {{ field }}
                    {% endfor %}
                    <div style="text-align: center;">
                        <input type="submit" name="submit_button" value="Submit" />
                    </div>
                </form>
            </div>
        {% endif %}
        <div class="checklist-right-col" style="width: 65%; margin-left: 2em;">
            <h4>
                {% if logistics.hangouts_confirmed|length >= logistics.min_hangouts %}
                    <span class="req done"></span>
                {% else %}
                    <span class="req not-done"></span>
                {% endif %}
                Officer Hangouts ({{ logistics.min_hangouts }} required, {{ logistics.hangouts_confirmed|length }} finished)
            </h4>
            <ul class="checkboxes">
                <ul class="conf-events">
                    {% for e in logistics.hangouts_confirmed %}
                        <li><a href="{% url 'events:detail' e.id %}">{{ e.name }}</a><br/></li>
                    {% endfor %}
                </ul>
                <ul class="unconf-events">
                    {% for e in logistics.hangouts_unconfirmed %}
                        <li><a href="{% url 'events:detail' e.id %}">{{ e.name }}</a><br/></li>
                    {% endfor %}
                </ul>
            </ul>

            <h4>
                {% if logistics.n_challenges_confirmed >= logistics.min_challenges %}
                    <span class="req done"></span>
                {% else %}
                    <span class="req not-done"></span>
                {% endif %}
                Officer Challenges ({{ logistics.min_challenges }} required, {{ logistics.n_challenges_confirmed }} finished)
            </h4>
            <ul class="checkboxes">
                {% include 'candidate/challenges_table.html' %}
            </ul>
        </div>
    </section>
</div>
{% endblock %}
